import{_ as q}from"./BQToi7vg.js";import{u as z,r as l,P as Q,c as n,a,q as _,v as x,t as d,s as r,Q as D,R as L,b as W,w as G,n as H,o,d as J}from"./CPMVF56r.js";import{i as K,e as X,g as Y,f as P,h as Z}from"./o8qONBl5.js";const ee={class:"bg-gradient-to-b from-gray-200 to-gray-100 min-h-screen py-8 px-4"},te=a("div",{class:"mb-4"},[a("p",{class:"big-center-text"},"Створіть оголошення")],-1),ae={class:"mb-4"},se={key:0,class:"text-red-500 text-xs"},le={class:"mb-4"},ne={key:0,class:"text-red-500 text-xs"},oe={class:"mb-4"},ie={id:"categories"},ue=["value"],re={key:0,class:"text-red-500 text-xs"},ce={class:"mb-4"},de={id:"cities"},pe=["value"],ve={key:0,class:"text-red-500 text-xs"},me={class:"mb-4"},fe={key:0,class:"text-red-500 text-xs"},ge={key:0,class:"text-red-500 text-xs text-center"},he={class:"mb-8"},ye=["src"],_e={class:"mb-8"},xe=["src"],be={class:"mb-8"},we=["src"],ke={class:"mb-8"},Ee=["src"],Ce={class:"flex justify-between items-center mb-8"},Ve=a("button",{type:"submit",class:"btn-admin"},"Подати оголошення",-1),je="https://buy-sell-api.onrender.com/api/user/ads",Re={__name:"add",setup(Ne){const F=z(),v=l(""),m=l(""),U=l(null),f=l(null),g=l(null),b=l(0),S=l(0),c=l([]),w=l([]),k=l([]),B=l(null),E=l(""),C=l(""),h=l(null),y=l(null),V=l(0),p=l(""),u=l([]),j=(i,e)=>{const s=i.target.files;if(s&&s.length>0){const t=s[0];if(t.type==="image/png"||t.type==="image/jpeg"){const N=new Blob([t],{type:t.type});u.value[e]=URL.createObjectURL(N),c.value[e]=t,p.value=""}else p.value="Неприпустимий тип файлу!",u.value[e]=null,c.value[e]=null,i.target.value=null}c.value.forEach(t=>{console.log(t)})};async function T(){B.value=await X(),U.value=Y();const i=await P("https://buy-sell-api.onrender.com/api/user/ads/categories"),e=await P("https://buy-sell-api.onrender.com/api/user/ads/cities");w.value=await i.json(),k.value=await e.json()}const A=i=>{const e=k.value.find(s=>s.name===i);return e?e.id:null},M=i=>{const e=w.value.find(s=>s.name===i);return e?e.id:null},I=async()=>{if(await $(),await O()){const e=new FormData;e.append("name",v.value),e.append("description",m.value),e.append("user",U.value.id),e.append("category",M(f.value)),e.append("city",A(g.value)),e.append("price",b.value),e.append("views",S.value),c.value.forEach((t,N)=>{e.append(`file${N+1}`,t)});const s=e.has("name");console.log('Дані з іменем "name" існують:',s);try{(await fetch(je,{method:"POST",body:e,headers:{Authorization:`Bearer ${B.value}`}})).ok?(console.log("Ad added successfully"),await Z(),F.push("/profile/user/ads")):console.error("Failed to add ad")}catch(t){console.error("Error:",t)}}};async function O(){if(v.value.length<10||v.value.length>100)return E.value="Ім'я повинно містити від 10 до 100 символів!",!1;if(m.value.length<10||m.value.length>500)return C.value="Опис повинен містити від 10 до 500 символів!",!1;if(f.value===null)return h.value="Виберіть категорію!",!1;if(!await R(f.value.trim(),w.value))return h.value="Такої категорії немає!",!1;if(g.value===null)return y.value="Виберіть місто!",!1;if(!await R(g.value.trim(),k.value))return y.value="Такого міста немає!",!1;const s=parseFloat(b.value);return isNaN(s)||s<1||s>1e6?(V.value="Ціна повинна бути числом від 1 до 1000000!",!1):c.value.some(t=>t!==null)?!0:(p.value="Додайте хочаб одне фото!",!1)}async function $(){E.value="",C.value="",h.value="",y.value="",V.value="",p.value=""}async function R(i,e){for(const s of e)if(typeof s.name=="string"&&s.name===i)return!0;return!1}return Q(()=>{K()||F.push("/auth/"),T()}),(i,e)=>{const s=q;return o(),n("div",ee,[a("form",{onSubmit:H(I,["prevent"]),enctype:"multipart/form-data",method:"post",class:"max-w-lg mx-auto bg-white p-8 rounded-lg shadow-md"},[te,a("div",ae,[_(a("input",{type:"text",placeholder:"Введіть назву","onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),class:"input-field",minlength:"10",maxlength:"100"},null,512),[[x,v.value]]),E.value?(o(),n("span",se,d(E.value),1)):r("",!0)]),a("div",le,[_(a("textarea",{placeholder:"Опишіть оголошення","onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t),class:"input-field-textarea",minlength:"10",maxlength:"300"},null,512),[[x,m.value]]),C.value?(o(),n("span",ne,d(C.value),1)):r("",!0)]),a("div",oe,[_(a("input",{list:"categories","onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),placeholder:"Виберіть категорію",class:"input-field"},null,512),[[x,f.value]]),a("datalist",ie,[(o(!0),n(D,null,L(w.value,t=>(o(),n("option",{key:t.id,value:t.name},d(t.name),9,ue))),128))]),h.value?(o(),n("span",re,d(h.value),1)):r("",!0)]),a("div",ce,[_(a("input",{list:"cities","onUpdate:modelValue":e[3]||(e[3]=t=>g.value=t),placeholder:"Виберіть місто",class:"input-field"},null,512),[[x,g.value]]),a("datalist",de,[(o(!0),n(D,null,L(k.value,t=>(o(),n("option",{key:t.id,value:t.name},d(t.name),9,pe))),128))]),y.value?(o(),n("span",ve,d(y.value),1)):r("",!0)]),a("div",me,[_(a("input",{type:"number",placeholder:"Введіть ціну","onUpdate:modelValue":e[4]||(e[4]=t=>b.value=t),min:"0",class:"input-field"},null,512),[[x,b.value,void 0,{number:!0}]]),V.value?(o(),n("span",fe,d(V.value),1)):r("",!0)]),p.value?(o(),n("span",ge,d(p.value),1)):r("",!0),a("div",he,[a("input",{type:"file",onChange:e[5]||(e[5]=t=>j(t,0)),accept:"image/png, image/jpeg",class:"input-field"},null,32),c.value[0]&&u.value[0]?(o(),n("img",{key:0,src:u.value[0],class:"image rounded-center",alt:"Додайте фото 1"},null,8,ye)):r("",!0)]),a("div",_e,[a("input",{type:"file",onChange:e[6]||(e[6]=t=>j(t,1)),accept:"image/png, image/jpeg",class:"input-field"},null,32),c.value[1]&&u.value[1]?(o(),n("img",{key:0,src:u.value[1],class:"image rounded-center",alt:"Додайте фото 2"},null,8,xe)):r("",!0)]),a("div",be,[a("input",{type:"file",onChange:e[7]||(e[7]=t=>j(t,2)),accept:"image/png, image/jpeg",class:"input-field"},null,32),c.value[2]&&u.value[2]?(o(),n("img",{key:0,src:u.value[2],class:"image rounded-center",alt:"Додайте фото 3"},null,8,we)):r("",!0)]),a("div",ke,[a("input",{type:"file",onChange:e[8]||(e[8]=t=>j(t,3)),accept:"image/png, image/jpeg",class:"input-field"},null,32),c.value[3]&&u.value[3]?(o(),n("img",{key:0,src:u.value[3],class:"image rounded-center",alt:"Додайте фото 4"},null,8,Ee)):r("",!0)]),a("div",Ce,[W(s,{to:"/profile/user/ads",class:"red-button"},{default:G(()=>[J("Назад")]),_:1}),Ve])],32)])}}};export{Re as default};
