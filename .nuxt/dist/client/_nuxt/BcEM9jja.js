import{_ as K}from"./BQToi7vg.js";import{u as X,r as s,P as Y,c as o,a as l,q as x,v as w,t as p,s as d,Q as I,R as M,b as Z,w as ee,n as te,o as i,d as ae}from"./CPMVF56r.js";import{i as le,b as se,e as ne,g as oe,f as E,h as ie}from"./o8qONBl5.js";const ue={class:"bg-gradient-to-b from-gray-200 to-gray-100 min-h-screen py-8 px-4"},re=l("div",{class:"mb-4"},[l("p",{class:"big-center-text"},"Редагування оголошення")],-1),ce={class:"mb-4"},de={key:0,class:"text-red-500 text-xs"},ve={class:"mb-4"},pe={key:0,class:"text-red-500 text-xs"},me={class:"mb-4"},ge={id:"categories"},fe=["value"],he={key:0,class:"text-red-500 text-xs"},ye={class:"mb-4"},_e={id:"cities"},be=["value"],xe={key:0,class:"text-red-500 text-xs"},we={class:"mb-4"},Ee={key:0,class:"text-red-500 text-xs"},ke={class:"mb-8"},Ce=["src"],je={class:"mb-8"},Ue=["src"],Ve={class:"mb-8"},Fe=["src"],Ne={class:"mb-8"},Re=["src"],Le={class:"flex justify-between items-center mb-8"},Se=l("button",{type:"submit",class:"btn-admin"},"Змінити оголошення",-1),Ae={__name:"edit",setup(Be){const P=X(),k=s(null),u=s(null),C=s(null),m=s(null),g=s(null),O=s(null),f=s(null),h=s(null),y=s(null),j=s([]),U=s([]),D=s(null);s(null);const r=s([]),c=s([]),V=s(""),F=s(""),_=s(null),b=s(null),N=s(0),R=s(""),L=(n,e)=>{const a=n.target.files;if(a&&a.length>0){const t=a[0];if(t.type==="image/png"||t.type==="image/jpeg"){const v=new Blob([t],{type:t.type});c.value[e]=URL.createObjectURL(v),r.value[e]=t,R.value=""}else R.value="Неприпустимий тип файлу!",c.value[e]=null,r.value[e]=null,n.target.value=null}r.value.forEach(t=>{console.log(t)})};async function $(){C.value=se().id,D.value=await ne(),O.value=oe(),k.value="https://buy-sell-api.onrender.com/api/user/ads/"+C.value,await G(k.value);const n=await E("https://buy-sell-api.onrender.com/api/user/ads/categories"),e=await E("https://buy-sell-api.onrender.com/api/user/ads/cities");j.value=await n.json(),U.value=await e.json(),await H(C.value,"https://buy-sell-api.onrender.com/api/user/ads-images/")}const q=async()=>{if(await J(),await z()){const e=new FormData;e.append("name",m.value),e.append("description",g.value),e.append("user",O.value.id),e.append("category",W(f.value)),e.append("city",Q(h.value)),e.append("price",y.value),e.append("views",u.value.views),console.log(JSON.stringify(r.value)),r.value.forEach((a,t)=>{e.append(`file${t+1}`,a)});try{const a="https://buy-sell-api.onrender.com/api/user/ads/"+C.value;(await fetch(a,{method:"PUT",body:e,headers:{Authorization:`Bearer ${D.value}`}})).ok?(console.log("Успішно збережено зміни!"),await localStorage.removeItem("editObject"),await ie(),P.push("/profile/user/ads")):console.error("Failed to add ad")}catch(a){console.error("Error:",a)}}};async function z(){if(m.value.length<10||m.value.length>100)return V.value="Ім'я повинно містити від 10 до 100 символів!",!1;if(g.value.length<10||g.value.length>500)return F.value="Опис повинен містити від 10 до 500 символів!",!1;if(f.value===null)return _.value="Виберіть категорію!",!1;if(!await T(f.value.trim(),j.value))return _.value="Такої категорії немає!",!1;if(h.value===null)return b.value="Виберіть місто!",!1;if(!await T(h.value.trim(),U.value))return b.value="Такого міста немає!",!1;const a=parseFloat(y.value);return isNaN(a)||a<1||a>1e6?(N.value="Ціна повинна бути числом від 1 до 1000000!",!1):r.value.some(t=>t!==null)?!0:(R.value="Додайте хочаб одне фото!",!1)}async function J(){V.value="",F.value="",_.value="",b.value="",N.value="",R.value=""}async function T(n,e){for(const a of e)if(typeof a.name=="string"&&a.name===n)return!0;return!1}const Q=n=>{const e=U.value.find(a=>a.name===n);return e?e.id:null},W=n=>{const e=j.value.find(a=>a.name===n);return e?e.id:null};async function G(n){try{const e=await E(n);e.ok?(u.value=await e.json(),m.value=u.value?u.value.name:null,g.value=u.value?u.value.description:null,y.value=u.value?u.value.price:null,f.value=u.value?u.value.category.name:null,h.value=u.value?u.value.city.name:null):console.error("Failed to fetch ad:",e.status)}catch(e){console.error("Error fetching ad:",e)}}async function H(n,e){try{k.value=e+n;const a=await E(k.value),t=await a.json();if(a.ok)for(let v=0;v<t.length;v++){let S="https://buy-sell-api.onrender.com/api/user/image/"+t[v].id;const A=await E(S);if(A.ok){const B=await A.blob();S=URL.createObjectURL(B),console.log("RESPONSE",B),c.value[v]=S,r.value[v]=B}}}catch(a){console.error("Error fetching photo:",a)}}return Y(()=>{le()||P.push("/auth/"),$()}),(n,e)=>{const a=K;return i(),o("div",ue,[l("form",{onSubmit:te(q,["prevent"]),enctype:"multipart/form-data",method:"post",class:"max-w-lg mx-auto bg-white p-8 rounded-lg shadow-md"},[re,l("div",ce,[x(l("input",{type:"text",placeholder:"Введіть назву","onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),class:"input-field",minlength:"10",maxlength:"100"},null,512),[[w,m.value]]),V.value?(i(),o("span",de,p(V.value),1)):d("",!0)]),l("div",ve,[x(l("textarea",{placeholder:"Опишіть оголошення","onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t),class:"input-field-textarea",minlength:"10",maxlength:"300"},null,512),[[w,g.value]]),F.value?(i(),o("span",pe,p(F.value),1)):d("",!0)]),l("div",me,[x(l("input",{list:"categories","onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),placeholder:"Виберіть категорію",class:"input-field"},null,512),[[w,f.value]]),l("datalist",ge,[(i(!0),o(I,null,M(j.value,t=>(i(),o("option",{key:t.id,value:t.name},p(t.name),9,fe))),128))]),_.value?(i(),o("span",he,p(_.value),1)):d("",!0)]),l("div",ye,[x(l("input",{list:"cities","onUpdate:modelValue":e[3]||(e[3]=t=>h.value=t),placeholder:"Виберіть місто",class:"input-field"},null,512),[[w,h.value]]),l("datalist",_e,[(i(!0),o(I,null,M(U.value,t=>(i(),o("option",{key:t.id,value:t.name},p(t.name),9,be))),128))]),b.value?(i(),o("span",xe,p(b.value),1)):d("",!0)]),l("div",we,[x(l("input",{type:"number",placeholder:"Введіть ціну","onUpdate:modelValue":e[4]||(e[4]=t=>y.value=t),min:"0",class:"input-field"},null,512),[[w,y.value,void 0,{number:!0}]]),N.value?(i(),o("span",Ee,p(N.value),1)):d("",!0)]),l("div",ke,[l("input",{type:"file",onChange:e[5]||(e[5]=t=>L(t,0)),accept:"image/png, image/jpeg",class:"input-field"},null,32),r.value[0]&&c.value[0]?(i(),o("img",{key:0,src:c.value[0],class:"image rounded-center",alt:"Додайте фото 1"},null,8,Ce)):d("",!0)]),l("div",je,[l("input",{type:"file",onChange:e[6]||(e[6]=t=>L(t,1)),accept:"image/png, image/jpeg",class:"input-field"},null,32),r.value[1]&&c.value[1]?(i(),o("img",{key:0,src:c.value[1],class:"image rounded-center",alt:"Додайте фото 2"},null,8,Ue)):d("",!0)]),l("div",Ve,[l("input",{type:"file",onChange:e[7]||(e[7]=t=>L(t,2)),accept:"image/png, image/jpeg",class:"input-field"},null,32),r.value[2]&&c.value[2]?(i(),o("img",{key:0,src:c.value[2],class:"image rounded-center",alt:"Додайте фото 3"},null,8,Fe)):d("",!0)]),l("div",Ne,[l("input",{type:"file",onChange:e[8]||(e[8]=t=>L(t,3)),accept:"image/png, image/jpeg",class:"input-field"},null,32),r.value[3]&&c.value[3]?(i(),o("img",{key:0,src:c.value[3],class:"image rounded-center",alt:"Додайте фото 4"},null,8,Re)):d("",!0)]),l("div",Le,[Z(a,{to:"/profile/user/ads",class:"red-button"},{default:ee(()=>[ae("Назад")]),_:1}),Se])],32)])}}};export{Ae as default};
